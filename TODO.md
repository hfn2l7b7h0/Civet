TODO
---

- [x] Compiler option to strip TypeScript and emit only JS (use in `./register`)
- [x] JavaScript Compat (default stance is JS code should "just work")
- [x] Multiple case/when expressions
- [x] Implicit Returns
  - [x] if without else: not all code paths return a value
  - [x] Should implicit returns apply to `case` inside `switch`? No because fallthrough could be intentional.
  - [x] Don't actually need to check for returns anywhere in a function, always implicit return the last statement
- [x] default const decs in `for in/of`
- [x] Postfix iteration (`while/until/for/loop`)
- [x] const assignment for function shorthand should use function declaration since TypeScript function declarations are const by default
  ```
  fn := (x) -> x
  ---
  function fn(x) { return x }
  ```
- [ ] Bugs
  - [ ] Existential unary postfix `?` precedence https://coffeescript.org/#try:x%20%2B%20a.b.c%3F
  - [ ] correct &block precedence with unary ops, binary ops, and call expressions. It works by chance in simple cases but won't in very complex ones.
- [ ] Comprehensions
  - [ ] CoffeeScript compat `for in`
  - [ ] Civet replacement `for from`
- [ ] Chained Comparisons (should work for all relational and equality operators)
  - [x] Basics working
  - [ ] use refs to avoid excess evaluations of middle results
- [x] `1.toString()` -> `1..toString()`
- [ ] `export x = ...` from CoffeeScript
- [ ] CoffeeScript Compat (cli flag or directive prolog "Coffee Compatability" for when Coffee is incompatible with JS)
  - [ ] Implicit `async`
  - [ ] Implicit generator functions
  - [x] If/Switch Expressions
  - [x] Auto Var
  - [x] on/off/yes/no
  - [x] `"""` `#{}` Interpolations
  - [x] `"` `#{}`Interpolations (with `"use coffee-compat"`)
  - [x] `###` Block comments
  - [x] `#` Comments (with `"use coffee-compat"`)
- [x] Import shorthand
- [x] `:=` `readonly` field shorthand
- [x] Keep comments and whitespace
- [x] `@` Class Static shorthand
- [x] `\`\`\`` TemplateLiteral blocks
- [ ] TypeScript
  - [ ] Parameter Properties
  https://www.typescriptlang.org/docs/handbook/2/classes.html#parameter-properties
  - [x] TS Compiling Experiment
  - [x] `interface` declaration
  - [x] `type` declaration
  - [x] Conditional types
    - [x] `extends`
    - [x] `infer`
  - [x] Optional Type
  - [x] TypeBinaryOperations `| &`
  - [x] UnaryOperator `typeof`
  - [x] Parentheses
  - [x] Type assertions `const x = "" as T`
  - [x] `keyof`
  - [x] Indexed Access Types `T['name']`
  - [x] Mapped Types
    - [x] Mapping modifiers
  - [x] Assertion Signatures
  - [x] Return Type Predicate
  - [x] Index signature
  - [x] `!` non-null assertion
  - [x] `declare`
  - [x] `namespace`
  - [x] `interface` methods
  - [ ] `abstract` class and fields
  - [x] nested | under a `type =` are being confused with nested object syntax
- [x] Keep shebang line
- [ ] JSX ðŸ˜¿
  - [x] Basic Support
  - [ ] Indentation based auto-closing JSX
- [ ] Infrastructure
  - [ ] 100% code coverage
    - [x] Accurate coverage for .civet files (need to compose ts-node source map with civet source map)
    - [ ] Hera sourcemaps
    - [ ] Test cli
  - [x] TS-node compatibility (may need to create a custom loader wrapping ts.LanguageServiceHost). The purpose of this feature is so we can run tests written in .civet.
    - [x] Extensible transpiled TS/JS esm loader (.hera, .coffee, .civet)
    - [x] Basic ESM Loader
  - [x] esbuild plugin so we can package up projects that contain `.civet` files
  - [ ] CoffeeSense inspired LSP
    - [x] Language Icon https://stackoverflow.com/a/70930298/68210
      - [x] Basic SVG Icon
      - [x] Get VSCode to use the fill color (VSCode editor was caching older version)
      - [x] Get VSCode to use the viewbox padding (VSCode editor was caching older version)
    - [ ] Experiment with forking/patching `vscode/extensions/typescript-language-features` to add a transpilation resolver and to sourcemap the messages
    - [ ] Syntax Highlighting
      - [x] Basic highlighting
      - [ ] Highlight Type Suffixes
      - [x] `case` should be same as `when` in control flow
      - [ ] Interpolated template strings
      - [ ] Shebang line
      - [ ] Short imports
      - [ ] TS Keywords
    - [x] Proper caching/versioning for scriptSnapshots
    - [x] Resolve .coffee files
    - [x] Resolve .hera files
    - [x] Load specifically included files (consistent with VSCode TS Extension)
    - [x] Some libraries are not loading?
      ```
        resolveModuleNames [ 'tslib', './main.js' ] /home/daniel/apps/civet/source/esm.civet
        failed to resolve tslib /home/daniel/apps/civet/source/esm.civet
      ```
    - [ ] Handle .civet files outside of project root
    - [ ] Handle multi-root projects
    - [ ] Use @danielx/civet installed in node_modules if present
    - [ ] Automate adding import suggestion
    - [ ] Handle file updates
      - [x] Add TextDocuments to service
      - [x] Update docs on changes
      - [x] Update sourcemap/meta on changes
    - [x] Sourcemapping
      - [x] Correctly map runtime errors using source-map-support in esm loader
      - [x] Finish adding source mappings to parser/transpiler
      - [ ] Minor Issues
        - [ ] Mappings for TypeScript
        - [ ] Mappings for JSX
        - [x] Postfix conditionals
        - [x] Block String sourcemapping
        - [x] `=`
        - [x] Multi-line comment sourcemapping (tsc doesn't map multi-line comments though)
        - [x] `const/readonly` in `:=`
        - [x] implied `imports` source map to ` from `
      - [ ] ~~Unpessimize source mapping output (later)~~ we actually need nearly every mapping so we can reliably remap from ts-node
      - [x] Translate from generated line/column to source line/column (reverse map)
      - [x] Translate from source line/column to generated line/column
    - [x] Document Symbols
    - [x] Hover docs (forward map)
    - [x] Completions (forward map)
    - [ ] References
    - [x] Load installed @types/*
    - [ ] Diagnostics (reverse map)
      - [x] Display Diagnostics
      - [x] Find out why diagnostic has weird `| undefined` in array types (it was excess comma in multi-line array bug)
- [ ] Syntax Experiments
  - [ ] Explore `gen.next(args, ...)` shorthand

TODONT
---

- [ ] CoffeeScript features
  - [ ] Heregex
