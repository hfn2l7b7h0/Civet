// TODO: figure out the magic ts-note/TypeScript config to make this work without destructuring from default import
import util from "../source/lib/util"
import assert from "assert"
import type { ScriptElementKind } from "typescript";
import type { DocumentSymbol } from "vscode-languageserver"
import Civet from "@danielx/civet"

{ intersectRanges, containsRange, makeRange, convertNavTree, remapPosition } := util

describe "util", ->
  it "should intersect ranges", ->
    range1 := makeRange(0, 0, 0, 10)
    range2 := makeRange(0, 5, 0, 8)
    assert(intersectRanges(range1, range2))

  it "should check containsRange", ->
    assert containsRange

  it.only "should remap source positions", ->
    src := `x := a + 3
y++

y = x + a`

    {code, sourceMap} := Civet.compile(src, {
      filename: "test.civet",
      sourceMap: true
    })

    linesMap := sourceMap.data.lines
    console.log code, linesMap

    position :=
      line: 1
      character: 0

    console.log remapPosition linesMap,
      line: 0
      character: 7
    console.log remapPosition linesMap, {
      line: 1
      character: 1
    }
