import TSService from "../source/lib/typescript-service.mjs"
import { pathToFileURL } from "url"
import { TextDocument } from "vscode-languageserver-textdocument"
import fs from "fs"

loadFile := (service: ReturnType<typeof TSService>, path: string) ->
  document := TextDocument.create(pathToFileURL(path).href, "civet", 0, fs.readFileSync(path, "utf8"))
  service.host.addOrUpdateDocument(document)

describe.only "ts service", ->
  it "should launch ts service", ->
    debugger
    service := TSService pathToFileURL("./").href

    filePath := "./source/a.civet"
    loadFile(service, filePath)

    diagnostics := service.getSemanticDiagnostics("/home/daniel/apps/civet/lsp/source/a.civet.ts")

    console.log diagnostics
    console.log service.host.getScriptFileNames()
