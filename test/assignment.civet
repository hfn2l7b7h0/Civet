{testCase} from ./helper.civet

describe "assignment", ->
  testCase """
    assignment
    ---
    a = b
    ---
    a = b
  """

  testCase """
    mutation
    ---
    a += b
    a -= b
    ---
    a += b
    a -= b
  """

  testCase """
    allows newlines
    ---
    a =
    b
    ---
    a =
    b
  """

  testCase """
    array destructuring
    ---
    [a, b] = c
    ---
    [a, b] = c
  """

  testCase """
    array destructuring rest element
    ---
    [a, ...b] = c
    ---
    [a, ...b] = c
  """

  testCase """
    array destructuring with non-end rest element
    ---
    [a, ...b, c] = d
    ---
    const splice: <T>(this: T[], start: number, deleteCount?: number) => T[] = [].splice as any
    [a, ...b] = d
    [c] = splice.call(b, -1)
  """

  testCase """
    object destructuring
    ---
    {a, b} = c
    ---
    ({a, b} = c)
  """

  testCase """
    object destructuring rest property
    ---
    {a, b, ...c} = d
    ---
    ({a, b, ...c} = d)
  """

  testCase """
    object destructuring reorder non-end rest property
    ---
    {a, ...b, c} = d
    ---
    ({a, c, ...b} = d)
  """

  testCase """
    @prop destructuring
    ---
    {@a, b} = c
    ---
    ({a: this.a, b} = c)
  """

  testCase """
    const assignment shorthand
    ---
    a := b
    {a, b} := c
    ---
    const a = b
    const {a, b} = c
  """

  testCase """
    const assignment nested object with implied braces
    ---
    a :=
      b: c
      d: e
    ---
    const a = {
      b: c,
      d: e,
    }
  """

  testCase """
    const assignment nested object with explicit braces
    ---
    a := {
      b: c
    }
    ---
    const a = {
      b: c
    }
  """

  testCase """
    assignment of object with object method
    ---
    x := {
      environment: 'node'
      retrieveFile(pathOrUrl: string)
        return 'wat'
    }
    ---
    const x = {
      environment: 'node',
      retrieveFile(pathOrUrl: string) {
        return 'wat'
      }
    }
  """

  describe.skip "TOMAYBE", ->
    testCase """
      multiple single line const assignments
      ---
      x := 1, y := 2
      ---
      const x = 1, y = 2
    """

  testCase """
    assign nested object
    ---
    const DefaultCompilerOptions =
      allowNonTsExtensions: true
      allowJs: true
      target: ts.ScriptTarget.Latest
      moduleResolution: ts.ModuleResolutionKind.NodeJs
      module: ts.ModuleKind.CommonJS
      allowSyntheticDefaultImports: true
      experimentalDecorators: true
    ---
    const DefaultCompilerOptions = {
      allowNonTsExtensions: true,
      allowJs: true,
      target: ts.ScriptTarget.Latest,
      moduleResolution: ts.ModuleResolutionKind.NodeJs,
      module: ts.ModuleKind.CommonJS,
      allowSyntheticDefaultImports: true,
      experimentalDecorators: true,
    }
  """

  testCase """
    all assignment operators
    ---
    a **= b
    a *= b
    a /= b
    a %= b
    a += b
    a -= b
    a <<= b
    a >>>= b
    a >>= b
    a &&= b
    a &= b
    a ^= b
    a ||= b
    a |= b
    a ??= b
    a ?= b
    a = b
    ---
    a **= b
    a *= b
    a /= b
    a %= b
    a += b
    a -= b
    a <<= b
    a >>>= b
    a >>= b
    a &&= b
    a &= b
    a ^= b
    a ||= b
    a |= b
    a ??= b
    a ??= b
    a = b
  """

  // TOMAYBE: Static semantics https://262.ecma-international.org/#sec-static-semantics-assignmenttargettype
  testCase """
    illegal assignment with function call
    ---
    a() = b
    ---
    a() = b
  """
