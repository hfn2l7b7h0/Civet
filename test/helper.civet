Hera from ../source/parser.hera
{parse} := Hera

gen from ../source/generate.coffee
assert from assert

{prune} := gen

verbose := false
displayAST := false

compare := (src: string, result: string, filename: string) ->
  ast := prune parse(src, {filename, verbose})
  if displayAST
    console.dir ast, {depth: null}

  assert.equal gen(ast, {}), result

testCase := (text: string) ->
  [desc, src, result] := text.split("\n---\n")

  it desc, ->
    compare src, result, desc

throws := (text: string) ->
  assert.throws ->
    gen(parse(text))

export {
  compare
  testCase
  throws
}
